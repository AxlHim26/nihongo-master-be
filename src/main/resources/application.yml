spring:
  application:
    name: miraigo
  profiles:
    default: dev
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_batch_fetch_size: 128
        batch_fetch_style: PADDED
        order_inserts: true
        order_updates: true
        jdbc:
          batch_size: 50
          time_zone: UTC
        query:
          in_clause_parameter_padding: true
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

server:
  port: ${SERVER_PORT:8080}
  compression:
    enabled: true
    min-response-size: 1024
    mime-types:
      - application/json
      - application/xml
      - text/html
      - text/xml
      - text/plain
      - text/css
      - application/javascript

management:
  endpoints:
    web:
      exposure:
        include:
          - health
          - info
          - metrics
          - prometheus
  endpoint:
    health:
      probes:
        enabled: true
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        app.db.query.execution: true

app:
  security:
    jwt:
      access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:24h}
      refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:7d}
    auth-cookie:
      refresh-token-name: ${AUTH_REFRESH_COOKIE_NAME:nm_refresh_token}
      path: ${AUTH_COOKIE_PATH:/api/v1/auth}
      domain: ${AUTH_COOKIE_DOMAIN:}
      http-only: true
      secure: ${AUTH_COOKIE_SECURE:false}
      same-site: ${AUTH_COOKIE_SAME_SITE:Lax}
    cors:
      allowed-methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      allowed-headers:
        - "*"
      exposed-headers:
        - Authorization
      allow-credentials: true
      max-age: 3600
    admin-bootstrap:
      key: ${ADMIN_BOOTSTRAP_KEY:}
  integrations:
    google-drive:
      application-name: ${GOOGLE_DRIVE_APPLICATION_NAME:MiraiGo}
      credentials-path: ${GOOGLE_APPLICATION_CREDENTIALS:}
  observability:
    sql:
      enabled: ${SQL_OBSERVABILITY_ENABLED:true}
      slow-query-log-enabled: ${SQL_SLOW_QUERY_LOG_ENABLED:true}
      slow-query-threshold-ms: ${SQL_SLOW_QUERY_THRESHOLD_MS:300}
      max-sql-length: ${SQL_SLOW_QUERY_MAX_SQL_LENGTH:800}
